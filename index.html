<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Tracker - Southwest Virtual Airlines</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="stylesheet" href="style.css"> <!-- Link to the separate CSS file -->
    <link rel="icon" type="image/svg+xml" href="icon.svg">
</head>
<body>
    <h1>Flight Tracker</h1>
    <div id="flight-form">
        <img src="takeoff.svg" class="icon">
        <input type="text" id="departure-input" placeholder="Enter departure airport">        
        <img src="landing.svg   " class="icon">
        <input type="text" id="arrival-input" placeholder="Enter arrival airport">   
        <button id="add-flight-button">Add Flight</button>
        <button id="reset-flights-button">Reset All Flights</button>
    </div>

    <div class="map-container">
        <div id="map"></div>
    </div>

    <div id="flight-list">
        <h2>Past Flights:</h2>
        <ul id="flights">
            <!-- List of flights will be displayed here -->
        </ul>
    </div>

    <footer>
        <p class="footer-content">This website is not affiliated with Southwest Virtual Airlines in any way</p>
    </footer>

    <!-- Modal HTML -->
    <div id="reset-modal" class="modal">
        <div class="modal-content">
            <img src="popup-animation.svg" class="airplane" alt="Airplane">
            <span class="close">&times;</span>
            <h2>Confirm Reset</h2>
            <p>Are you sure you want to delete all your archived flights?</p>
            <button id="confirm-reset">Yes, Reset</button>
            <button id="cancel-reset">Cancel</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <script>
        // Function to convert text to Upper Case
        function toUpperCase(str) {
            return str.toUpperCase();
        }
    
        const map = L.map('map').setView([39.8283, -98.5795], 4); // Centered on the US
    
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
    
        let markers = [];
        let flights = [];
        const apiKey = '7a33fc0eb49e4a8d967a17d0234ae41b'; // Replace with your OpenCage API key
    
        function loadFlights() {
            const savedFlights = JSON.parse(localStorage.getItem('flights')) || [];
            savedFlights.forEach((flight, index) => {
                if (flight && flight.departure && flight.arrival) {
                    const departureLatLng = [flight.departure.lat, flight.departure.lng];
                    const arrivalLatLng = [flight.arrival.lat, flight.arrival.lng];
    
                    const departureMarker = L.marker(departureLatLng).addTo(map);
                    const arrivalMarker = L.marker(arrivalLatLng).addTo(map);
    
                    const flightLine = L.polyline([departureLatLng, arrivalLatLng], { color: '#007bff', weight: 3, opacity: .5 }).addTo(map);
    
                    const flightList = document.getElementById('flights');
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        ${toUpperCase(flight.departure.place)} - ${toUpperCase(flight.arrival.place)}
                        <button class="delete-button" onclick="deleteFlight(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    flightList.appendChild(listItem);
                    
                    markers.push({ marker: [departureMarker, arrivalMarker], line: flightLine });
                    flights.push(flight); // Maintain reference to flight data
                }
            });
    
            map.setView([39.8283, -98.5795], 4); // Reset view to the US
        }
    
        function saveFlights() {
            const flightData = flights.map(flight => {
                if (flight && flight.line) {
                    const latLngs = flight.line.getLatLngs();
                    return {
                        departure: { lat: latLngs[0].lat, lng: latLngs[0].lng, place: flight.departurePlace },
                        arrival: { lat: latLngs[1].lat, lng: latLngs[1].lng, place: flight.arrivalPlace }
                    };
                }
            }).filter(Boolean); // Filter out undefined results
            localStorage.setItem('flights', JSON.stringify(flightData));
        }
    
        function addFlight() {
            const departureInput = document.getElementById('departure-input').value;
            const arrivalInput = document.getElementById('arrival-input').value;
            const departure = toUpperCase(departureInput);
            const arrival = toUpperCase(arrivalInput);
    
            if (departure && arrival) {
                Promise.all([
                    fetch(`https://api.opencagedata.com/geocode/v1/json?q=${departure}&key=${apiKey}`).then(response => response.json()),
                    fetch(`https://api.opencagedata.com/geocode/v1/json?q=${arrival}&key=${apiKey}`).then(response => response.json())
                ]).then(results => {
                    const [departureData, arrivalData] = results;
                    if (departureData.results.length > 0 && arrivalData.results.length > 0) {
                        const departureLocation = departureData.results[0].geometry;
                        const arrivalLocation = arrivalData.results[0].geometry;
                        const departureLatLng = [departureLocation.lat, departureLocation.lng];
                        const arrivalLatLng = [arrivalLocation.lat, arrivalLocation.lng];
    
                        const departureMarker = L.marker(departureLatLng).addTo(map);
                        const arrivalMarker = L.marker(arrivalLatLng).addTo(map);
                        markers.push({ marker: [departureMarker, arrivalMarker] });
    
                        const flightLine = L.polyline([departureLatLng, arrivalLatLng], { color: '#007bff', weight: 3, opacity: .5 }).addTo(map);
                        flights.push({ line: flightLine, departurePlace: departure, arrivalPlace: arrival });
                        flightLine.departurePlace = departure; // Store additional data
                        flightLine.arrivalPlace = arrival; // Store additional data
    
                        const flightList = document.getElementById('flights');
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `
                            ${departure} - ${arrival}
                            <button class="delete-button" onclick="deleteFlight(${flights.length - 1})">
                                <i class="fas fa-trash"></i>
                            </button>
                        `;
                        flightList.appendChild(listItem);
    
                        saveFlights(); // Save flights to localStorage
    
                        // Clear the input fields
                        document.getElementById('departure-input').value = '';
                        document.getElementById('arrival-input').value = '';
                    } else {
                        alert('One or both airports not found');
                    }
                }).catch(err => {
                    alert('Geocode was not successful for the following reason: ' + err);
                });
            }
        }
    
        function deleteFlight(index) {
            if (flights[index]) {
                if (flights[index].line) {
                    flights[index].line.remove();
                }
                markers[index].marker.forEach(marker => marker.remove());
                flights.splice(index, 1);
                markers.splice(index, 1);
                saveFlights();
                updateFlightList();
            } else {
                console.log('Flight not found at index:', index);
            }
        }
    
        function updateFlightList() {
            const flightList = document.getElementById('flights');
            flightList.innerHTML = '';
            flights.forEach((flight, index) => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    ${toUpperCase(flight.departurePlace)} - ${toUpperCase(flight.arrivalPlace)}
                    <button class="delete-button" onclick="deleteFlight(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                flightList.appendChild(listItem);
            });
        }
    
        function resetFlights() {
            const modal = document.getElementById('reset-modal');
            const closeButton = document.querySelector('.modal .close');
            const confirmButton = document.getElementById('confirm-reset');
            const cancelButton = document.getElementById('cancel-reset');
    
            modal.classList.add('show'); // Show modal with animation
    
            closeButton.onclick = function() {
                modal.classList.remove('show'); // Hide modal with animation
                setTimeout(() => modal.style.display = 'none', 300); // Ensure modal is hidden after animation
            };
    
            cancelButton.onclick = function() {
                modal.classList.remove('show'); // Hide modal with animation
                setTimeout(() => modal.style.display = 'none', 300); // Ensure modal is hidden after animation
            };
    
            confirmButton.onclick = function() {
                markers.forEach(item => {
                    item.marker.forEach(marker => marker.remove());
                    item.line && item.line.remove(); // Check if line exists before calling remove
                });
                markers = [];
                flights = [];
                localStorage.removeItem('flights');
                updateFlightList();
                modal.classList.remove('show'); // Hide modal with animation
                setTimeout(() => modal.style.display = 'none', 300); // Ensure modal is hidden after animation
            };
        }
    
        document.getElementById('add-flight-button').addEventListener('click', addFlight);
        document.getElementById('reset-flights-button').addEventListener('click', resetFlights);
    
        loadFlights(); // Load flights when the page loads
    </script>
    
</body>
</html>
